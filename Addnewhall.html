<!DOCTYPE html>
<html>

<head>
  <title>GB</title>
  <meta charset="utf-8">
  <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="css/font-awesome.min.css">
  <link rel="stylesheet" type="text/css" href="css/addnewhall.css">
  <link rel="stylesheet" type="text/css" href="css/admin.css">
  <link rel="stylesheet" type="text/css" href="css/formdesign.css">
  <link rel="stylesheet" type="text/css" href="css/animate.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css" integrity="sha384-5sAR7xN1Nv6T6+dT2mhtzEpVJvfS3NScPQTrOxhwjIuvcA67KV2R5Jz6kr4abQsz"
    crossorigin="anonymous">
  <link href="https://fonts.googleapis.com/css?family=Lobster" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Merienda" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Amaranth" rel="stylesheet">
</head>

<body>
  <section class="nav">
  </section>
  <section id="op">
    <div class="add">   
      <h1 class="text-center">Add New Hall</h1>
      <form id="survey-form" enctype="application/x-www-form-urlencoded">

        <label id="name-label" for="name"><p>Hall Name</p>
          <br>
          <input type="text" id="name" placeholder="Hall Name" name="hallName" required>
        </label>
        <label id="name-label" for="name"><p>Hall Adress</p>
          <br>
          <input type="text" id="ha" placeholder="Hall Adress" name="hallAdress" required>
        </label>
        <label><span>Categories</span></label>
        <select id="demo" onclick="editP()">
          <option>Select Category</option>
        </select>
        <label id="name-label" for="name"><p>Hall Description</p>
          <br>
          <input type="text" id="hd" placeholder="Hall Description" name="hallDescription" required>
        </label>
        <label id="name-label" for="name"><p>Hall Price</p>
          <br>
          <input type="text" id="hp" placeholder="Hall Price" name="hallPrice" required>
        </label>
        <label id="name-label" for="name"><p>Hall Location Long</p>
          <br>
          <input type="text" id="hl" placeholder="Hall Location Long" name="hallLocationLong" required>
        </label>
        <label id="name-label" for="name"><p>Hall Location Lat</p>
          <br>
          <input type="text" id="hla" placeholder="Hall Location Lat" name="hallLocationLat" required>
        </label>
        <label id="name-label" for="name"><p>Hall Special Offers</p>
          <br>
          <input type="text" id="hs" placeholder="Hall Special Offers" name="hallSpecialOffers">
        </label>
        <label id="name-label" for="name"><p>Hall Phone Number</p>
          <br>
          <input type="text" id="hpn" placeholder="Hall Phone Number" name="hallPhoneNumber" required>
        </label>

        <label id="name-label" for="name"><p>Hall Image (Max 6 Images)</p>
          <br>
          <input type="file" id="hi" placeholder="Hall Image" name="hallImage" multiple class="move">
        </label>
        <button type="button" id="submit" value="Send" onclick="upload()" disabled> Add</button>

        <div id="res"></div>
      </form>
    </div>
  </section>
  <script type="text/javascript" src="js/jquery.min.js"></script>
  <script type="text/javascript" src="js/bootstrap.min.js"></script>
  <script type="text/javascript" src="js/edit.js"></script>
  <script type="text/javascript" src="js/wow.min.js"></script>
  <script type="text/javascript"> new WOW().init();</script>
  <script type="text/javascript" src="js/simpleUpload.js"></script>
  <script>
$(function(){
  $(".nav").load("nav.html");
});

    var token = window.localStorage.getItem('token');

    var SERVER_URL = 'https://hidden-ocean-87285.herokuapp.com';
    var IMAGES_UPLOAD_URL = '/halls/UploadImages';

    var $fileInputElement = $('input[type="file"]');
    var images= [];
    var fileLength=0;
    var uploadedImage=0;
    $('input[type=file]').change(function(){
      fileLength = this.files.length;
    });
    function upload() {

      var $name = $("#name");
          var $Adress = $("#ha");
          var $Description = $("#hd");
          var $Price = $("#hp");
          var $LocationLong = $("#hl");
          var $LocationLat = $("#hla");
          var $PhoneNumber = $("#hpn");
          var name = $name.val().trim();
          var Adress = $Adress.val().trim();
          var Description = $Description.val().trim();
          var Price = $Price.val().trim();
          var LocationLong = $LocationLong.val().trim();
          var LocationLat = $LocationLat.val().trim();
          var PhoneNumber = $PhoneNumber.val().trim();
          if(name.length < 1) {
              alert("Please Fill the Name field");
          }else if (Adress.length < 1) {
    alert("Please Fill the Adress field");
  }else if (Description.length < 1) {
    alert("Please Fill the Description field");
  }else if (Price.length < 1) {
    alert("Please Fill the Price field");
  }else if (LocationLong.length < 1) {
    alert("Please Fill the Hall Location Long field");
  }else if (LocationLat.length < 1) {
    alert("Please Fill the Hall Location Lat field");
  }else if (PhoneNumber.length < 1) {
    alert("Please Fill the Hall Phone Number field");
  }else {
            $fileInputElement.simpleUpload(SERVER_URL + IMAGES_UPLOAD_URL, {

        start: function handleStart(file) {

        },

        progress: function handleProgress(progress) {
          // Received progress
        },

        success: function handleSuccess(data) {
          uploadedImage++;
          images.push(data.result);
          if(fileLength == uploadedImage){
            var imagg = JSON.stringify(images)
            AddHall(imagg);
          }
        },

        error: function handleError(error) {
          // Upload failed

          console.error(error);
        }
      });
  }
        
        

    }
    function AddHall(imagesFiles) {

      var hallName = $("#name").val();
      var hallAdress = $("#ha").val();
      var hallCategory = $("#demo").val();
      var hallDescription = $("#hd").val();
      var hallPrice = $("#hp").val();
      var hallLocationLong = $("#hl").val();
      var hallLocationLat = $("#hla").val();
      var hallSpecialOffers = $("#hs").val();
      var hallPhoneNumber = $("#hpn").val();
      var hallImage = $("#hi").val();

      let requestBody = {
        hallName: hallName,
        hallAdress: hallAdress,
        hallCategory: hallCategory,
        hallDescription: hallDescription,
        hallPrice: hallPrice,
        hallLocationLong: hallLocationLong,
        hallLocationLat: hallLocationLat,
        hallSpecialOffers: hallSpecialOffers,
        hallPhoneNumber: hallPhoneNumber,
        hallImage: imagesFiles

      }

      $.ajax({
        url: "https://hidden-ocean-87285.herokuapp.com/halls",
        type: 'POST',
        contentType: 'application/x-www-form-urlencoded',
        beforeSend: function (xhr) {
          //xhr.setRequestHeader('file',JSON.parse( fd));

          xhr.setRequestHeader('authorization', 'Bearer ' + token);
        },

        data: requestBody,
        success: function (data) {
          alert(data.message);
            window.location.href = 'Addnewhall.html'
          // CallBack(result);
        },
      error: function (data) {
          
      }
      });


    }
      
              function editP() {
     document.getElementById("submit").removeAttribute("disabled"); 
}
  </script>
</body>

</html>